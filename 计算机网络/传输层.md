*概述*：负责主机间的数据传输，提供可靠的数据传输服务和流量控制
- TCP(传输控制协议)：为调用它的应用程序提供了一种可靠的、 面向连接的服务，拥有拥塞控制
- UDP(用户数据报协议)：提供了一种不可靠、无连接的服务，无拥塞控制
- IP(网际协议)：网络层通信协议，为主机之间提供逻辑通信，尽力交付服务

*多路复用与多路分解*：
- 概述：将网络层提供的主机与主机的交付服务延伸到应用进程到进程的交付服务。(进程与本机之间的交互)
- 多路复用要求：1、源端口号，2、目的端口号。总计32bit
- 端口号：由16bit数组成，大小在0~65535之间，
	- 周知端口号1~1023，被分配给系统应用
- 分解服务：当报文到达主机时，运输层检查报文段中的目的端口号，并将它定向到相应的套接字

*可靠数据传输(rdt)*：保证不出错，不丢失
- 确认阶段：接收方对分组进行校验，如果数据正确，返回ACK；数据错误，返回NAK，发送方根据放回结果决定下一个发送对象，如果为NAK，重新发送一个分组，直到收到ACK
- 顺序控制(停止-等待协议)：
	- rdt2.1：增加0，1状态量，在分组中加入序列号(0,1)以两个分组为一个校验阶段，从而防止ACK重复递交导致数据重复，确保数据顺序正确；
	- rdt2.2：无NAK协议，用最后接收正确分组的ACK替代NAK，从而减少确认信息
	- rdt3.0：增加超时重传机制，通过重传解决丢包问题
	- rdt的缺陷：发送方——接收方之间停止等待时间(RTT)占比过大，导致资源利用率过低
- 流水线协议：
	- 原理：允许发送方在未得到对方确认的情况下一次性发送多个分组
	- 方法：
		- 增加序号范围，用多个bit表示分组序号
		- 增加缓冲区，发送方用以等待重传，接收方用于将接受的乱序数据排序交付
	- 滑动窗口协议：
		- 发送窗口：在未接收的情况下一次发送多个分组，窗口大小由发送缓冲区大小决定，当确认接收后，窗口向后滑动
		- 接收窗口：大小由缓冲区大小确定，按顺序移动，只有低序号的分组到来，窗口才向后移动
- 两种通用的流水线协议：
	- GBN协议：
		- 接收方缓冲区大小为1，顺序接收分组；
		- 只需设置一个定时器，时间到达重传所有未确认分组
		- 异常处理：当接收数据失败时，发送方重新发送整个缓冲区的分组
		- 特点：简单，所需资源少，出错回退代价大，适用于出错率低，
	- SR协议：
		- 接收方缓冲区大小>1，允许乱序接收分组
		- 为每个分组保持一个定时器，单独发送未确认分组
		- 异常处理：某个分组接收失败时，单独重发该分组
		- 特点：出错时重传代价小，所需资源多

*TCP协议*
- TCP概述：点对点，可靠的数据传输，拥塞控制，发送和接收缓存，全双工数据流动，面向连接，有拥塞控制（http/https协议底层是依靠TCP传输协议）
- TCP报文段结构：
	- 源端口号(16bit)
	- 目标端口号(16bit)
	- 序号(32bit)：报文段首字节在字节流中的编号
	- 确认号(32bit)：已经确认接收的报文段编号
	- 注：确认号是目标端口期望获取的第一个字段id，因此确认号和序列号首位编号是一样的
- TCP往返延时(RTT)和超时：
	- 超时时间根据估算时间和采样时间动态设置
	- TCP快速重传：
		- 原理：如果发送方连续收到3个冗余的ACK，重传最小序号的段
		- 作用：在计时器超时之前重发报文段，从而增加传输效率
- TCP流量控制：
	- 由接收方控制发送方，不让发送方发送数据太多，导致缓冲区溢出
- TCP连接管理：
	- 在正式交换数据前，发送方和接收方握手建立通信关系
	- 2次握手的隐患：超时后继续建立连接，导致服务器维护被废弃的半连接，浪费资源
	- 3次握手本质：发送方向接收方请求连接，接收方接收连接并向发送方发送反请求，发送方接收反请求并向请求方返回响应结果，接收方接收响应，连接建立
	- 关闭连接：把TCP连接看成两个半连接，一方向另一方发起请求关闭信息，关闭对向连接
- TCP拥塞控制：
	- 检测拥塞：超时检测
	- 控制拥塞：
		- 慢启动阶段(AIMD)：初始cwnd为1，每收到ACK后，cwnd翻倍
		- 拥塞避免阶段：当达到上次拥塞时值的一半，进入拥塞避免状态，线性增加cwnd
		- 快速恢复阶段：当丢包之后，立即重传丢失的数据段，cwnd减半，后线性增加

*拥塞控制*
- 定义：太多的数据需要网络传输，超过了网络的处理能力
- 拥塞的表现：
	- 分组丢失
	- 分组经历较长的延时